# ItemCF ç®—æ³•å®ç°

æœ¬ç« å°†é€šè¿‡å®Œæ•´çš„ä»£ç ç¤ºä¾‹æ¥æ¼”ç¤ºå¦‚ä½•ä»é›¶å¼€å§‹å®ç°åŸºäºç‰©å“çš„ååŒè¿‡æ»¤ç®—æ³•ï¼ˆItemCFï¼‰ã€‚

## ğŸ¯ å­¦ä¹ ç›®æ ‡

é€šè¿‡æœ¬ç« å­¦ä¹ ï¼Œæ‚¨å°†æŒæ¡ï¼š

- ItemCF ç®—æ³•çš„æ ¸å¿ƒæ€æƒ³å’Œå®ç°æ­¥éª¤
- å¦‚ä½•æ„å»ºç”¨æˆ·-ç‰©å“äº¤äº’çŸ©é˜µ
- ç‰©å“ç›¸ä¼¼åº¦è®¡ç®—æ–¹æ³•
- æ¨èç”Ÿæˆçš„å…·ä½“è¿‡ç¨‹

## ğŸ“Š ç®—æ³•åŸç†

ItemCFï¼ˆItem-based Collaborative Filteringï¼‰çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š**ç›¸ä¼¼çš„ç‰©å“ä¼šè¢«åŒæ ·çš„ç”¨æˆ·å–œæ¬¢**ã€‚

ç®—æ³•æ­¥éª¤ï¼š
1. æ„å»ºç”¨æˆ·-ç‰©å“äº¤äº’çŸ©é˜µ
2. è®¡ç®—ç‰©å“ä¹‹é—´çš„ç›¸ä¼¼åº¦
3. åŸºäºç›¸ä¼¼åº¦ä¸ºç”¨æˆ·ç”Ÿæˆæ¨è

## ğŸ’» å®Œæ•´ä»£ç å®ç°

```python title="code/ItemCF/Main.py"
import pandas as pd
from sklearn.metrics.pairwise import cosine_similarity


def item_based_collaborative_filtering():
    """
    ä¸€ä¸ªå®Œæ•´çš„ã€ä»é›¶å¼€å§‹çš„ItemCFç®—æ³•å®ç°æµç¨‹ã€‚
    This function demonstrates a complete, from-scratch implementation of the ItemCF algorithm.
    """
    # --- ç¬¬ä¸€æ­¥ï¼šå‡†å¤‡æ•°æ® (å»ºç«‹"æ±Ÿæ¹–æ¡£æ¡ˆåº“") ---
    # åœ¨çœŸå®ä¸–ç•Œé‡Œï¼Œè¿™éƒ¨åˆ†æ•°æ®ä¼šæ¥è‡ªæ‚¨çš„æ•°æ®åº“æˆ–æ—¥å¿—æ–‡ä»¶ã€‚
    # è¿™é‡Œæˆ‘ä»¬ç”¨ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥æ¨¡æ‹Ÿæ‚¨çš„"èŠ±åå†Œæ•°æ®"ã€‚
    # 1 ä»£è¡¨å­¦ç”Ÿä¸Šè¿‡è¿™é—¨è¯¾ã€‚
    data = {
        'å°æ˜': {'æ•°å­¦': 1, 'ç‰©ç†': 1, 'åŒ–å­¦': 0, 'ç”Ÿç‰©': 0, 'å†å²': 0},
        'å°çº¢': {'æ•°å­¦': 1, 'ç‰©ç†': 0, 'åŒ–å­¦': 1, 'ç”Ÿç‰©': 1, 'å†å²': 0},
        'å°å¼º': {'æ•°å­¦': 0, 'ç‰©ç†': 1, 'åŒ–å­¦': 1, 'å†å²': 1, 'ç”Ÿç‰©': 0},
        'å°ç¾': {'æ•°å­¦': 0, 'ç‰©ç†': 0, 'åŒ–å­¦': 1, 'ç”Ÿç‰©': 1, 'å†å²': 1},
        'å°å': {'æ•°å­¦': 1, 'ç‰©ç†': 1, 'åŒ–å­¦': 1, 'ç”Ÿç‰©': 1, 'å†å²': 0}
    }

    # å°†æ•°æ®è½¬æ¢ä¸ºPandas DataFrameæ ¼å¼ï¼Œè¿™æ˜¯è¿›è¡Œæ•°æ®åˆ†æçš„å¸¸ç”¨å·¥å…·ã€‚
    # ç”¨æˆ·ä¸ºè¡Œï¼Œè¯¾ç¨‹ä¸ºåˆ—ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬çš„"ç”¨æˆ·-ç‰©å“äº¤äº’çŸ©é˜µ"ã€‚
    df = pd.DataFrame(data).T  # .T è¡¨ç¤ºè½¬ç½®ï¼Œè®©ç”¨æˆ·æˆä¸ºè¡Œ
    df = df.fillna(0)  # å°†æ²¡æœ‰è®°å½•çš„NaNå€¼å¡«å……ä¸º0

    print("--- 1. ç”¨æˆ·-è¯¾ç¨‹äº¤äº’çŸ©é˜µ (åŸå§‹æ•°æ®) ---")
    print(df)
    print("\n" + "=" * 50 + "\n")

    # --- ç¬¬äºŒæ­¥ï¼šè®¡ç®—ç‰©å“ï¼ˆè¯¾ç¨‹ï¼‰ä¹‹é—´çš„ç›¸ä¼¼åº¦ (ç»˜åˆ¶"ç‰©å“å…³ç³»ç½‘") ---
    # æˆ‘ä»¬ä½¿ç”¨`cosine_similarity`ï¼ˆä½™å¼¦ç›¸ä¼¼åº¦ï¼‰æ¥è®¡ç®—ã€‚
    # æ³¨æ„ï¼šæˆ‘ä»¬éœ€è¦å¯¹è¯¾ç¨‹ï¼ˆåˆ—ï¼‰è¿›è¡Œè®¡ç®—ï¼Œæ‰€ä»¥è¦å†æ¬¡è½¬ç½®çŸ©é˜µ df.T
    item_similarity_df = pd.DataFrame(
        cosine_similarity(df.T),
        index=df.columns,
        columns=df.columns
    )

    print("--- 2. è¯¾ç¨‹ä¸è¯¾ç¨‹ä¹‹é—´çš„ç›¸ä¼¼åº¦çŸ©é˜µ ---")
    print(item_similarity_df)
    print("\n" + "=" * 50 + "\n")

    # --- ç¬¬ä¸‰æ­¥ï¼šä¸ºæŒ‡å®šç”¨æˆ·ç”Ÿæˆæ¨è (é¡ºè—¤æ‘¸ç“œï¼ŒåŠ æƒæ¨è) ---
    target_user = 'å°æ˜'

    print(f"--- 3. å¼€å§‹ä¸ºç”¨æˆ· '{target_user}' ç”Ÿæˆæ¨è ---")

    # 3.1 æ‰¾å‡ºç›®æ ‡ç”¨æˆ·ä¸Šè¿‡ï¼ˆè¯„åˆ†ä¸º1ï¼‰çš„æ‰€æœ‰è¯¾ç¨‹
    user_courses = df.loc[target_user]
    taken_courses = user_courses[user_courses == 1].index.tolist()
    
    print(f"ç”¨æˆ· {target_user} å·²ç»ä¸Šè¿‡çš„è¯¾ç¨‹: {taken_courses}")

    # 3.2 è®¡ç®—æ¨èåˆ†æ•°
    recommendations = {}
    
    # å¯¹äºæ¯ä¸€é—¨ç”¨æˆ·æ²¡æœ‰ä¸Šè¿‡çš„è¯¾ç¨‹
    for course in df.columns:
        if course not in taken_courses:  # åªæ¨èç”¨æˆ·æ²¡ä¸Šè¿‡çš„è¯¾ç¨‹
            score = 0
            # åŸºäºç”¨æˆ·å·²ä¸Šè¿‡çš„æ¯é—¨è¯¾ç¨‹è®¡ç®—æ¨èåˆ†æ•°
            for taken_course in taken_courses:
                # æ¨èåˆ†æ•° = ç›¸ä¼¼åº¦ Ã— ç”¨æˆ·å¯¹å·²ä¸Šè¯¾ç¨‹çš„è¯„åˆ†ï¼ˆè¿™é‡Œéƒ½æ˜¯1ï¼‰
                score += item_similarity_df.loc[course, taken_course] * user_courses[taken_course]
            recommendations[course] = score

    # 3.3 æŒ‰æ¨èåˆ†æ•°æ’åº
    sorted_recommendations = sorted(recommendations.items(), key=lambda x: x[1], reverse=True)
    
    print(f"\nä¸ºç”¨æˆ· {target_user} çš„æ¨èç»“æœ:")
    for course, score in sorted_recommendations:
        print(f"  {course}: {score:.4f}")

    return sorted_recommendations


if __name__ == "__main__":
    # è¿è¡ŒItemCFç®—æ³•
    recommendations = item_based_collaborative_filtering()
    
    print("\n" + "=" * 50)
    print("ğŸ‰ ItemCF ç®—æ³•æ¼”ç¤ºå®Œæˆï¼")
    print("=" * 50)
```

## ğŸ” ä»£ç è¯¦è§£

### 1. æ•°æ®å‡†å¤‡

```python
# ç”¨æˆ·-ç‰©å“äº¤äº’çŸ©é˜µ
data = {
    'å°æ˜': {'æ•°å­¦': 1, 'ç‰©ç†': 1, 'åŒ–å­¦': 0, 'ç”Ÿç‰©': 0, 'å†å²': 0},
    'å°çº¢': {'æ•°å­¦': 1, 'ç‰©ç†': 0, 'åŒ–å­¦': 1, 'ç”Ÿç‰©': 1, 'å†å²': 0},
    # ... æ›´å¤šç”¨æˆ·æ•°æ®
}
```

è¿™é‡Œæ„å»ºäº†ä¸€ä¸ªç®€å•çš„ç”¨æˆ·-è¯¾ç¨‹äº¤äº’çŸ©é˜µï¼Œå…¶ä¸­ï¼š
- è¡Œä»£è¡¨ç”¨æˆ·
- åˆ—ä»£è¡¨è¯¾ç¨‹ï¼ˆç‰©å“ï¼‰
- å€¼ä¸º1è¡¨ç¤ºç”¨æˆ·ä¸Šè¿‡è¯¥è¯¾ç¨‹ï¼Œ0è¡¨ç¤ºæ²¡æœ‰

### 2. ç›¸ä¼¼åº¦è®¡ç®—

```python
item_similarity_df = pd.DataFrame(
    cosine_similarity(df.T),  # æ³¨æ„è½¬ç½®
    index=df.columns,
    columns=df.columns
)
```

ä½¿ç”¨ä½™å¼¦ç›¸ä¼¼åº¦è®¡ç®—ç‰©å“ä¹‹é—´çš„ç›¸ä¼¼æ€§ï¼š

$$\text{similarity}(i,j) = \frac{\sum_{u \in U} r_{ui} \cdot r_{uj}}{\sqrt{\sum_{u \in U} r_{ui}^2} \cdot \sqrt{\sum_{u \in U} r_{uj}^2}}$$

### 3. æ¨èç”Ÿæˆ

```python
for course in df.columns:
    if course not in taken_courses:
        score = 0
        for taken_course in taken_courses:
            score += item_similarity_df.loc[course, taken_course] * user_courses[taken_course]
        recommendations[course] = score
```

æ¨èåˆ†æ•°çš„è®¡ç®—å…¬å¼ï¼š

$$\text{score}(u,i) = \sum_{j \in I_u} \text{similarity}(i,j) \cdot r_{uj}$$

å…¶ä¸­ï¼š
- $u$ æ˜¯ç›®æ ‡ç”¨æˆ·
- $i$ æ˜¯å¾…æ¨èçš„ç‰©å“
- $I_u$ æ˜¯ç”¨æˆ· $u$ å·²äº¤äº’çš„ç‰©å“é›†åˆ
- $r_{uj}$ æ˜¯ç”¨æˆ· $u$ å¯¹ç‰©å“ $j$ çš„è¯„åˆ†

## ğŸš€ è¿è¡Œç¤ºä¾‹

è¿è¡Œä¸Šè¿°ä»£ç ï¼Œæ‚¨å°†çœ‹åˆ°ï¼š

```
--- 1. ç”¨æˆ·-è¯¾ç¨‹äº¤äº’çŸ©é˜µ (åŸå§‹æ•°æ®) ---
     æ•°å­¦  ç‰©ç†  åŒ–å­¦  ç”Ÿç‰©  å†å²
å°æ˜    1    1    0    0    0
å°çº¢    1    0    1    1    0
å°å¼º    0    1    1    1    1
å°ç¾    0    0    1    1    1
å°å    1    1    1    1    0

--- 2. è¯¾ç¨‹ä¸è¯¾ç¨‹ä¹‹é—´çš„ç›¸ä¼¼åº¦çŸ©é˜µ ---
        æ•°å­¦      ç‰©ç†      åŒ–å­¦      ç”Ÿç‰©      å†å²
æ•°å­¦  1.0000  0.5000  0.5000  0.3333  0.0000
ç‰©ç†  0.5000  1.0000  0.5000  0.3333  0.3333
åŒ–å­¦  0.5000  0.5000  1.0000  0.8000  0.5000
ç”Ÿç‰©  0.3333  0.3333  0.8000  1.0000  0.6667
å†å²  0.0000  0.3333  0.5000  0.6667  1.0000

ä¸ºç”¨æˆ· å°æ˜ çš„æ¨èç»“æœ:
  åŒ–å­¦: 1.0000
  ç”Ÿç‰©: 0.6667
  å†å²: 0.3333
```

## ğŸ’¡ ç®—æ³•ä¼˜åŒ–å»ºè®®

### 1. ç›¸ä¼¼åº¦è®¡ç®—ä¼˜åŒ–
- **çš®å°”é€Šç›¸å…³ç³»æ•°**: è€ƒè™‘ç”¨æˆ·è¯„åˆ†çš„åå¥½å·®å¼‚
- **è°ƒæ•´ä½™å¼¦ç›¸ä¼¼åº¦**: å‡å°‘è¯„åˆ†åå·®çš„å½±å“
- **Jaccardç›¸ä¼¼åº¦**: é€‚ç”¨äºéšå¼åé¦ˆæ•°æ®

### 2. ç¨€ç–æ€§å¤„ç†
```python
# è®¾ç½®æœ€å°å…±åŒäº¤äº’ç”¨æˆ·æ•°é‡é˜ˆå€¼
min_common_users = 3
if common_users_count < min_common_users:
    similarity = 0
```

### 3. å®æ—¶æ€§ä¼˜åŒ–
- **å¢é‡æ›´æ–°**: åªé‡æ–°è®¡ç®—æ¶‰åŠçš„ç‰©å“ç›¸ä¼¼åº¦
- **é¢„è®¡ç®—**: ç¦»çº¿é¢„è®¡ç®—ç›¸ä¼¼åº¦çŸ©é˜µ
- **ç¼“å­˜ç­–ç•¥**: ç¼“å­˜çƒ­é—¨ç‰©å“çš„æ¨èç»“æœ

## ğŸ¯ ç»ƒä¹ ä»»åŠ¡

1. **ä¿®æ”¹æ•°æ®é›†**: å°è¯•ä½¿ç”¨æ›´å¤§çš„ç”¨æˆ·-ç‰©å“äº¤äº’æ•°æ®
2. **è¯„åˆ†æ‰©å±•**: å°†äºŒå…ƒè¯„åˆ†æ‰©å±•ä¸º1-5åˆ†çš„è¯„åˆ†ç³»ç»Ÿ
3. **ç›¸ä¼¼åº¦å¯¹æ¯”**: å®ç°å¹¶æ¯”è¾ƒä¸åŒç›¸ä¼¼åº¦è®¡ç®—æ–¹æ³•çš„æ•ˆæœ
4. **æ¨èè§£é‡Š**: ä¸ºæ¨èç»“æœæ·»åŠ è§£é‡ŠåŠŸèƒ½

## ğŸ“š ç›¸å…³èµ„æ–™

- [ä½™å¼¦ç›¸ä¼¼åº¦è¯¦è§£](../theory/06-similarity-computation.md)
- [ItemCFç®—æ³•ç†è®º](../algorithms/07-itemcf-analysis.md)
- [æ¨èç³»ç»Ÿè¯„ä¼°æŒ‡æ ‡](../theory/01-core-concepts.md)

---

!!! tip "ä¸‹ä¸€æ­¥"
    æŒæ¡äº†ItemCFçš„å®ç°åï¼Œå»ºè®®ç»§ç»­å­¦ä¹  [é€»è¾‘å›å½’å®ç°](logistic-regression.md)ï¼Œäº†è§£åŸºäºæ¨¡å‹çš„æ¨èæ–¹æ³•ã€‚ 